<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>NBA 2K23 MyCareer Calculator</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    :root {
      --bg: #0f172a;
      --text: #e2e8f0;
      --accent: #38bdf8;
      --section: #1e293b;
      --highlight: #fbbf24;
    }
    body.light-mode {
      --bg: #f8fafc;
      --text: #1e293b;
      --accent: #0ea5e9;
      --section: #e2e8f0;
      --highlight: #ca8a04;
    }
    body {
      font-family: 'Segoe UI', sans-serif;
      background: var(--bg);
      color: var(--text);
      margin: 0;
      padding: 20px;
      transition: all 0.3s ease;
    }
    h1, h2, h3 {
      color: var(--accent);
      margin-bottom: 10px;
    }
    .container {
      display: flex;
      flex-direction: row;
      gap: 20px;
      justify-content: space-between;
      flex-wrap: wrap;
    }
    .panel {
      flex: 1 1 300px;
      background: var(--section);
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 0 10px rgba(0,0,0,0.5);
      min-width: 300px;
    }
    label {
      display: block;
      margin-top: 10px;
    }
    input, select, button {
      padding: 8px;
      margin-top: 5px;
      width: 100%;
      border-radius: 5px;
      border: none;
      font-size: 16px;
      box-sizing: border-box;
    }
    button {
      background: var(--accent);
      color: black;
      cursor: pointer;
      font-weight: bold;
      margin-top: 15px;
      width: auto;
    }
    .result {
      font-weight: bold;
      font-size: 18px;
      color: var(--highlight);
      margin-top: 10px;
    }
    .top-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      flex-wrap: wrap;
    }
    .top-bar button {
      margin-left: 10px;
    }
    .file-input {
      display: none;
    }
    @media (max-width: 768px) {
      .container {
        flex-direction: column;
      }
      .top-bar {
        flex-direction: column;
        align-items: flex-start;
      }
      .top-bar > div {
        margin-top: 10px;
      }
    }
  </style>
</head>
<body>
<div class="top-bar">
  <h1>NBA 2K23 MyCareer Tool</h1>
  <div>
    <button onclick="exportData()">üíæ Export JSON</button>
    <label>
      <input type="file" class="file-input" id="importFile" accept=".json" onchange="importData(event)">
      <button onclick="document.getElementById('importFile').click()">üìÇ Import JSON</button>
    </label>
    <button onclick="toggleDarkMode()">üåì Toggle Dark Mode</button>
  </div>
</div>

<div class="container">
  <!-- Points Bank Panel -->
  <div class="panel">
    <h2>Points Bank</h2>
    <label>Total Points Bank:
      <input type="number" id="manualTotalPoints" value="1000">
    </label>
    <div class="result">Total Points Bank: <span id="pointsBankDisplay">1000</span></div>
  </div>

  <!-- Bonus Multipliers Panel -->
  <div class="panel">
    <h2>Bonus Multipliers</h2>

    <label>Game Result:
      <select id="gameResult" onchange="toggleOTBox()">
        <option value="win">Win</option>
        <option value="otwin">OT Win</option>
        <option value="lose">Lose</option>
        <option value="otlose">OT Lose</option>
      </select>
    </label>

    <div id="otCountBox" style="display:none;">
      <label>Overtime Count (1‚Äì6):
        <input type="number" id="otCount" min="1" max="6" value="1">
      </label>
    </div>

    <label>Opponent Type:
      <select id="opponentType">
        <option value="1">Easy Opponent</option>
        <option value="1.25">Normal Opponent</option>
        <option value="1.5">Hard Opponent</option>
        <option value="1.75">1st in Conference</option>
        <option value="2">1st/2nd in League</option>
        <option value="3">All-Star Game</option>
      </select>
    </label>

    <label>Team Last Season:
      <select id="teamHistory">
        <option value="1">Did Not Make Playoffs</option>
        <option value="1.25">1st Round</option>
        <option value="1.5">2nd Round</option>
        <option value="1.75">Semifinalist</option>
        <option value="1.9">Finalist</option>
        <option value="2">Defending Champions</option>
      </select>
    </label>

    <button onclick="toggleMultiplierInfo()">‚ÑπÔ∏è Explanation</button>
    <div id="multiplierInfo" style="display: none; margin-top:10px;">
      <p><strong>Game Result:</strong><br>Win √ó1.5, OT Win +0.1 per OT (max 6), OT Lose √ó1.25</p>
      <p><strong>Opponent:</strong> Easy √ó1, Normal √ó1.25, etc.</p>
      <p><strong>Team History:</strong> Champs √ó2, Finalist √ó1.9, etc.</p>
    </div>

    <label><input type="checkbox" id="disablePointAdd"> Don't add to total bank</label>
  </div>

  <!-- Game Stats Panel -->
  <div class="panel">
    <h2>Game Stats</h2>
    <form id="statsForm" onsubmit="event.preventDefault(); calculateTotalPoints();">
      <label>Points (gpts): <input type="number" name="gpts" value="0"></label>
      <label>Rebounds (greb): <input type="number" name="greb" value="0"></label>
      <label>Assists (gast): <input type="number" name="gast" value="0"></label>
      <label>Steals (gstl): <input type="number" name="gstl" value="0"></label>
      <label>Blocks (gblk): <input type="number" name="gblk" value="0"></label>
      <label>2PT Made (g2pt): <input type="number" name="g2pt" value="0"></label>
      <label>3PT Made (g3pt): <input type="number" name="g3pt" value="0"></label>
      <label>Free Throws (gfts): <input type="number" name="gfts" value="0"></label>
      <label>Turnovers (gtov): <input type="number" name="gtov" value="0"></label>
      <label>Fouls (gfls): <input type="number" name="gfls" value="0"></label>
      <label>+/- Score (gpm): <input type="number" name="gpm" value="0"></label>
      <button type="submit">Calculate Points Earned</button>
    </form>
    <div class="result">Points Earned: <span id="pointsEarned">0</span></div>
  </div>

  <!-- Upgrade Panel -->
  <div class="panel">
    <h2>Attribute Upgrade Cost</h2>

    <div>
      <h3>Offense</h3>
      <label>Current Rating: <input type="number" id="offenseCurrent" value="60"></label>
      <label>Target Rating: <input type="number" id="offenseTarget" value="70"></label>
      <div class="result">Cost: <span id="offenseCost">0</span></div>
    </div>

    <div>
      <h3>Defense</h3>
      <label>Current Rating: <input type="number" id="defenseCurrent" value="60"></label>
      <label>Target Rating: <input type="number" id="defenseTarget" value="70"></label>
      <div class="result">Cost: <span id="defenseCost">0</span></div>
    </div>

    <div>
      <h3>Athleticism</h3>
      <label>Current Rating: <input type="number" id="athleticCurrent" value="60"></label>
      <label>Target Rating: <input type="number" id="athleticTarget" value="70"></label>
      <div class="result">Cost: <span id="athleticCost">0</span></div>
    </div>

    <div>
      <h3>Mental</h3>
      <label>Current Rating: <input type="number" id="mentalCurrent" value="60"></label>
      <label>Target Rating: <input type="number" id="mentalTarget" value="70"></label>
      <div class="result">Cost: <span id="mentalCost">0</span></div>
    </div>

    <button onclick="calculateAllUpgrades()">Calculate All Upgrade Costs</button>
    <div class="result" id="upgradeSummary"></div>
    <button onclick="confirmUpgrade()">Confirm Upgrade</button>
  </div>
</div>

<script>
  const pointValues = {
    gpts: 2, greb: 5, gast: 5, gstl: 10, gblk: 10,
    g2pt: 2, g3pt: 3, gfts: 1, gtov: -2, gfls: -1, gpm: 5
  };

  const upgradeCostPerPoint = {
    offense: r => (r < 60 ? 0 : r <= 79 ? 8 : r <= 89 ? 20 : r <= 94 ? 35 : 50),
    mental: r => (r < 60 ? 0 : r <= 79 ? 7 : r <= 89 ? 18 : r <= 94 ? 30 : 45),
    defense: r => (r < 60 ? 1 : r <= 79 ? 11 : r <= 89 ? 25 : r <= 94 ? 50 : 75),
    athleticism: r => (r < 60 ? 5 : r <= 79 ? 15 : r <= 89 ? 35 : r <= 94 ? 65 : 100)
  };

  function toggleDarkMode() {
    document.body.classList.toggle('light-mode');
  }

  function toggleOTBox() {
    document.getElementById("otCountBox").style.display = document.getElementById("gameResult").value === "otwin" ? "block" : "none";
  }

  function toggleMultiplierInfo() {
    const info = document.getElementById("multiplierInfo");
    info.style.display = info.style.display === "none" ? "block" : "none";
  }

  function calculateTotalPoints() {
    const form = document.forms['statsForm'];
    let earned = 0;
    for (let key in pointValues) {
      earned += (parseInt(form[key].value) || 0) * pointValues[key];
    }

    const result = document.getElementById("gameResult").value;
    const opp = parseFloat(document.getElementById("opponentType").value);
    const team = parseFloat(document.getElementById("teamHistory").value);
    const disable = document.getElementById("disablePointAdd").checked;

    let multiplier = 1;
    if (result === "win") multiplier = 1.5;
    else if (result === "otwin") {
      const ot = Math.min(6, parseInt(document.getElementById("otCount").value) || 1);
      multiplier = 1.5 + (0.1 * ot);
    } else if (result === "otlose") multiplier = 1.25;

    const total = Math.round(earned * multiplier * opp * team);
    const bank = document.getElementById('manualTotalPoints');
    const newTotal = disable ? parseInt(bank.value) : parseInt(bank.value) + total;

    if (!disable) bank.value = newTotal;
    document.getElementById('pointsEarned').innerText = total;
    document.getElementById('pointsBankDisplay').innerText = newTotal;
  }

  function calculateAllUpgrades() {
    const categories = ['offense', 'defense', 'athletic', 'mental'];
    let totalCost = 0;
    const bank = parseInt(document.getElementById('manualTotalPoints').value);

    for (let cat of categories) {
      const current = parseInt(document.getElementById(`${cat}Current`).value);
      const target = parseInt(document.getElementById(`${cat}Target`).value);
      const display = document.getElementById(`${cat}Cost`);

      if (isNaN(current) || isNaN(target) || current >= target) {
        display.innerText = "Invalid";
        continue;
      }

      let cost = 0;
      for (let i = current + 1; i <= target; i++) {
        cost += upgradeCostPerPoint[cat === 'athletic' ? 'athleticism' : cat](i);
      }

      display.innerText = cost;
      totalCost += cost;
    }

    const summary = document.getElementById("upgradeSummary");
    summary.innerHTML = `
      Total Upgrade Cost: ${totalCost}<br>
      Points Before Upgrade: ${bank}<br>
      Points After Upgrade: ${bank - totalCost}
    `;
    summary.dataset.totalCost = totalCost;
  }

  function confirmUpgrade() {
    const cost = parseInt(document.getElementById("upgradeSummary").dataset.totalCost || "0");
    const bankInput = document.getElementById('manualTotalPoints');
    const currentPoints = parseInt(bankInput.value);

    if (cost > currentPoints) {
      alert("Not enough points for upgrade!");
      return;
    }

    bankInput.value = currentPoints - cost;
    document.getElementById("pointsBankDisplay").innerText = bankInput.value;
    alert("Upgrade applied!");
  }
</script>
</body>
</html>
